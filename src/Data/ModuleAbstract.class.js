
Lava.define(
'Lava.data.ModuleAbstract',
/**
 * @lends Lava.data.ModuleAbstract#
 * @extends Lava.mixin.Observable
 */
{

	Extends: 'Lava.mixin.Observable',

	_config: null,
	_fields: {},
	_records: [],
	_records_by_guid: {},
	_storages_by_guid: {},

	_initFields: function(config) {

		var field_name,
			type,
			constructor,
			default_storage = {};

		for (field_name in config.fields) {

			type = config.fields[field_name].type || Lava.schema.data.DEFAULT_FIELD_TYPE;
			constructor = Lava.ClassManager.getConstructor(type, 'Lava.data.field');
			this._fields[field_name] = new constructor(
				this,
				field_name,
				config.fields[field_name],
				this._storages_by_guid
			);

		}

		for (field_name in this._fields) {

			this._fields[field_name].onModuleFieldsCreated(default_storage);

		}

		return default_storage;

	},

	/**
	 * This function is autogenerated in constructor
	 *
	 * @returns {Object}
	 */
	_createEmptyRecordStorage: function() {

		return {};

	},

	destroy: function() {

		var name,
			i = 0,
			count = this._records.length;

		/*for (; i < count; i++) {

			this._records[i].destroy();

		}*/

		for (name in this._fields) {

			this._fields[name].destroy();

		}

		this._records = this._records_by_guid = this._storages_by_guid = this._fields = null;

	}

});